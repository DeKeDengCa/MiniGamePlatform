syntax = "proto3";

package comm.mgr.guild;

import "protobuf/api/guild/bd.proto";
import "protobuf/api/common/common.proto";
import "protobuf/mgr/guild/common.proto";
import "protobuf/api/adapter/model.proto";

option java_package = "com.entertain.sns.comm.mgr.guild";
option go_package = "gitit.cc/social/protobuf/gencode/mgr/pbmguild";

// ServiceName: rpc.micro.social.guild
// smicro:spath=gitit.cc/social/components-service/social-guild/handler-mgr/bd
service BDMgr {
  // 新增
  rpc SaveBD(SaveBDReq) returns (SaveBDRsp);
  // 删除
  rpc DeleteBD(DeleteBDReq) returns (DeleteBDRsp);
  // 转让
  rpc TransferBD(TransferBDReq) returns (TransferBDRsp);
  // 查询
  rpc ListBD(ListBDReq) returns (ListBDRsp);

  // 查询BD旗下成员
  rpc ListBDMember(ListBDMemberReq) returns (ListBDMemberRsp);

  // 绑定BD旗下成员
  rpc BindBDMember(BindBDMemberReq) returns (BindBDMemberRsp);

  // 审核通过BD旗下成员
  rpc ApproveBDMember(ApproveBDMemberReq) returns (ApproveBDMemberRsp);

  // 审核拒绝BD旗下成员
  rpc RejectBDMember(RejectBDMemberReq) returns (RejectBDMemberRsp);

  // 获取BD创建的人
  rpc ListBDCreator(ListBDCreatorReq)returns(ListBDCreatorRsp);

  // 获取BD成员审核人
  rpc ListBDMemberAuditor(ListBDMemberAuditorReq)returns(ListBDMemberAuditorRsp);
}
message SaveBDReq {
  int64 bd_id = 1;    // 0表征新增，非0表征修改
  BDUser bd = 2;      // BD信息
}

message SaveBDRsp {
  int64 bd_id = 1;
}


message DeleteBDReq {
  int64 bd_id = 1;
  BDUser record = 10;     // 记录日志用
}

message DeleteBDRsp {
}


message TransferBDReq {
  int64 bd_id = 1;
  int64 from_uid = 2;     // 原用户
  int64 to_uid = 3;       // 转让给哪个用户
}

message TransferBDRsp {
}


message ListBDReq {
  scommon.Page page = 1;      // 分页参数
  ListBDSearch search = 10;   // 搜索参数，不传则
}

message ListBDRsp {
  scommon.Page page = 1;
  repeated BDUser list = 10;
}

// BD用户信息
message BDUser {
  int64 id = 1;                       // BD ID
  int64 uid = 2;                      // BD用户
  comm.api.guild.BDType type = 3;     // BD类型
  string nick = 4;                    // BD 昵称
  string cou = 5;                     // BD 国家
  string whatsapp = 6;                // BD WhatsApp 账号
  string remark = 9;                  // 备注
  BDStats stats = 10;                 // 管理数据
  OperationMeta operation_meta = 50;  // oms操作信息
}

// 搜索项，字段默认值表示不筛选
message ListBDSearch {
  int64 uid = 1;                  // 根据uid搜索
  comm.api.guild.BDType type = 2; // 根据类型搜索
  TimeRange created_at = 3;       // 根据创建时间搜索
  bool include_deleted = 4;       // 是否包含删除的
  string cou = 5;                 // 根据国家搜索
  string created_by = 6;          // 创建人
  comm.api.adapter.YoN deleted = 7; // 是否已删除
  int64 id = 8;                // bd记录ID
}


// BD统计数据
message BDStats {
  int64 guilds = 1;       // 管理公会数
  int64 users = 2;        // 管理用户数
}

// BD 旗下成员
message BDMember {
  int64 id = 1;                                         // 主键
  int64 bd_id = 20;                                     // bd记录ID
  int64 bd_uid = 21;                                    // bd 的 uid
  string bd_nick = 22;                                  // bd 昵称
  string bd_cou = 23;                                   // bd 的国家
  string bd_whatsapp = 24;                              // bd WhatsApp 账号
  int64 member_uid = 4;                                 // 成员UID
  comm.api.guild.BDMemberType member_type = 5;          // 成员类型
  string member_cou = 6;                                // 成员国家
  string member_info = 7;                               // 成员的信息 (JSON 字符串, 对应 BDMemberInfoXXX 结构体)
  int64 member_info_update_time = 8;                    // 修改成员信息时间
  string member_level = 9;                              // 成员等级, 审核通过时指定
  comm.api.guild.BDMemberBindWay bind_way = 10;         // 绑定方式, BD手动/系统自动/运营手动
  int64 bind_at = 11;                                   // 绑定时间
  string bind_by = 12;                                  // 绑定人, oms 上绑定才有值
  comm.api.guild.BDMemberAuditStatus audit_status = 13; // 审核状态
  string audit_reason = 14;                             // 审核原因
  int64 audit_at = 15;                                  // 审核时间
  string audit_by = 16;                                 // 审核人
  string member_stat = 100;                             // 成员的数据统计(JSON字符串, 对应 BDMemberStatXXX 结构体)
}

enum BDMemberSortField {
  BD_MEMBER_SORT_FIELD_NONE = 0;
  BD_MEMBER_SORT_FIELD_AUDIT_STATUS = 1; // 审核状态
  BD_MEMBER_SORT_FIELD_MEMBER_INFO_UPDATE_TIME = 2; // 修改成员信息时间
  BD_MEMBER_SORT_FIELD_ID = 3; // bd 成员ID
  BD_MEMBER_SORT_FIELD_AUDIT_AT = 4; // 审核时间
  BD_MEMBER_SORT_FIELD_BIND_AT = 5; // 绑定时间
}

message ListBDMemberReq {
  scommon.Page page = 1;                                            // 分页参数
  scommon.Sorts sorts = 2;                                          // 排序参数

  repeated comm.api.guild.BDMemberAuditStatus audit_statuses = 10;  // 审核状态(必传)
  int64 audit_at_start = 11;                                        // 审核时间开始
  int64 audit_at_end = 12;                                          // 审核时间结束
  int64 member_info_update_time_start = 13;                         // 修改成员信息时间-开始
  int64 member_info_update_time_end = 14;                           // 修改成员信息时间-结束
  int64 bd_id = 20;                                                 // bd id
  string bd_cou = 21;                                               // bd 国家
  string member_cou = 30;                                           // 成员国家
  comm.api.guild.BDMemberType member_type = 31;                     // 成员类型
  string audit_by = 32;                                             // 审核人
  int64 member_uid = 40;                                            // 成员UID
  int64 bind_at_start = 41;                                         // 绑定时间-开始
  int64 bind_at_end = 42;                                           // 绑定时间-结束
}

message ListBDMemberRsp {
  scommon.Page page = 1;                                // 分页参数
  repeated BDMember members = 10;                       // 成员列表
}

message BindBDMemberReq {
  int64 bd_id = 10;
  int64 member_uid = 11;
}

message BindBDMemberRsp {
  int64 id = 1; // 成员ID
}

message ApproveBDMemberReq {
  int64 member_id = 10;
  string member_level = 11;
}

message ApproveBDMemberRsp {

}

message RejectBDMemberReq {
  int64 member_id = 10;
  string audit_reason = 11;
}

message RejectBDMemberRsp {

}

message ListBDCreatorReq {
}
message ListBDCreatorRsp {
  repeated string creators = 1;
}

message ListBDMemberAuditorReq {
}
message ListBDMemberAuditorRsp {
  repeated string auditors = 1;
}