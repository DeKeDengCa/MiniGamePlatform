syntax = "proto3";

package comm.mgr.platform.gpiap;

option go_package = "gitit.cc/social/components-service/social-platform/proto/pbmgpiap";

// Google Play In App Products 谷歌应用内商品管理接口
// smicro:spath=gitit.cc/social/components-service/social-platform/biz/gpiap/handlermgr
service GPIAPMgr {

    // 列出所有应用
    rpc ListApplication(ListApplicationReq) returns (ListApplicationRsp);

    // 导入应用内商品-一次性商品
    rpc ImportProduct(ImportProductReq) returns (ImportProductRsp);

    // 列出应用内商品-一次性商品
    rpc ListProduct(ListProductReq) returns (ListProductRsp);
}

message Application {
    string application_name = 1;    // 应用名称
    string package_name = 2;        // 应用包名
    string default_currency = 3;    // 默认货币码
    string default_language = 4;    // 默认语言码
}

message ListApplicationReq {

}

message ListApplicationRsp {
    repeated Application applications = 10;
}

// 数据格式
enum DataFormat {
    DATA_FORMAT_NONE = 0;                   // 未定义格式
    DATA_FORMAT_CSV = 1;                    // CSV 格式
}

message ImportProductReq {
    string package_name = 1;                // 包名
    DataFormat data_format = 2;             // 数据格式
    repeated OneTimeProduct products = 3;          // 商品列表
}

message ImportProductRsp {
    repeated OneTimeProduct products = 1;          // 商品列表
}

message TokenPagination {
    string next_page_token = 1;             // 下一页令牌
    string prev_page_token = 2;             // 上一页令牌
}

message ListProductReq {
    string package_name = 1;                // 包名
    string page_token = 2;                  // 分页令牌
}

message ListProductRsp {
    TokenPagination token_pagination = 1;   // 令牌分页
    repeated OneTimeProduct products = 2;          // 应用内商品列表
}

// 有关指定地理区域税费方面的详细信息
message RegionalTaxConfig {
    string region_code = 1;  // 必需。相应配置适用地区的地区代码（按照 ISO 3166-2 的定义），例如“US”。
    /*
    税费档位，用于指定较低的税率。在各个地区销售数字新闻、杂志、报纸、图书或有声读物的开发者可能有资格享受较低的税率。
    TAX_TIER_UNSPECIFIED
    TAX_TIER_BOOKS_1
    TAX_TIER_NEWS_1
    TAX_TIER_NEWS_2
    TAX_TIER_MUSIC_OR_AUDIO_1
    TAX_TIER_LIVE_OR_BROADCAST_1
    */
    string tax_tier = 2;
    /*
    您必须指明您的应用是否包含在线播放产品，以便系统正确地收取美国的州销售税和地方销售税。此字段仅在美国受支持。
    */
    bool eligible_for_streaming_service_tax_rate = 3;
    /*
    如要在美国收取通信税或娱乐税，请选择适当的税种。
    STREAMING_TAX_TYPE_UNSPECIFIED	不征收电信税。
    STREAMING_TAX_TYPE_TELCO_VIDEO_RENTAL	美国特有的电信税费档位，适用于视频在线播放、点播、租借 / 订阅 / 按观看次数付费。
    STREAMING_TAX_TYPE_TELCO_VIDEO_SALES	美国特有的电信税费档位，适用于预先录制的内容（例如影片、电视节目）的视频串流。
    STREAMING_TAX_TYPE_TELCO_VIDEO_MULTI_CHANNEL	美国特有的电信税费档位，适用于多频道节目的视频串流。
    STREAMING_TAX_TYPE_TELCO_AUDIO_RENTAL	美国特有的电信税费档位，适用于音频串流、租借 / 订阅。
    STREAMING_TAX_TYPE_TELCO_AUDIO_SALES	美国特有的电信税费档位，适用于音频串流、销售 / 永久下载。
    STREAMING_TAX_TYPE_TELCO_AUDIO_MULTI_CHANNEL	美国特有的电信税费档位，适用于多频道音频串流，例如电台。
    */
    string streaming_tax_type = 4;
}

message RegionsVersion {
    string version = 1; // 必需。一个字符串，表示当前用于指定资源的可用地区的版本
}

message OneTimeProductListing {
    string language_code = 1;   // 必需。相应商品详情的语言（按照 BCP-47 的定义），例如“en-US”。
    string title = 2;   // 必需。相应商品的商品名（采用相应商品详情所用的语言）。长度上限为 55 个字符。
    string description = 3; // 必需。相应商品的说明（采用相应商品详情所用的语言）。长度上限为 200 个字符。
}

// 一次性商品在税费、Google Play 政策和法规遵从方面的详细信息。
message OneTimeProductTaxAndComplianceSettings {
    repeated RegionalTaxConfig regional_tax_configs = 1; // 地区性税费配置。
    bool is_tokenized_digital_asset = 2; // 相应一次性商品是否已声明为表示代币化数字资产的商品。
}

// 一次性商品购买选项在税费、Google Play 政策和法规遵从方面的详细信息。
message PurchaseOptionTaxAndComplianceSettings {
    //    枚举
    //    WITHDRAWAL_RIGHT_TYPE_UNSPECIFIED
    //    WITHDRAWAL_RIGHT_DIGITAL_CONTENT
    //    WITHDRAWAL_RIGHT_SERVICE
    string withdrawal_right_type = 1;  // 可选。面向符合条件地区的用户分发的商品的数字内容或服务类别。如果未设置，则默认为 WITHDRAWAL_RIGHT_DIGITAL_CONTENT。
}

message Money {
    string currency_code = 1;   // ISO 4217 中定义的由三个字母组成的货币代码。
    string units = 2;   // 金额的整数单位。例如，如果 currencyCode 为 "USD"，则 1 单位就是一美元。
    int32 nanos = 3;    // 金额的纳诺 (10^-9) 单位数。这个值必须在 -999999999（含）和 +999999999（含）之间。如果 units 是正数，nanos 必须是正数或零。如果 units 为零，nanos 可以是正数、零或负数。如果 units 为负数，则 nanos 必须为负数或零。例如 $-1.75 表示为 units=-1 和 nanos=-750,000,000。
}

// 购买选项的地区性定价和提供情况配置
message RegionalPricingAndAvailabilityConfig {
    string region_code = 1; // 必需。相应配置适用地区的地区代码（按照 ISO 3166-2 的定义），例如“US”。
    Money price = 2; // 指定地区内相应购买选项的价格。必须以与指定地区相关联的币种设置。

//    枚举
//    AVAILABILITY_UNSPECIFIED	未指定提供情况。不得使用。
//    AVAILABLE	相应购买选项目前已面向用户提供。
//    NO_LONGER_AVAILABLE	相应购买选项已不再面向用户提供。只有在之前曾将优惠提供情况设置为 AVAILABLE 的情况下才能使用此值。
//    AVAILABLE_IF_RELEASED	相应购买选项最初未提供，但通过已发布的预订优惠提供。
    string availability = 3;    // 相应购买选项的提供情况。
}

message OneTimeProductPurchaseOptionNewRegionsConfig {
    Money usd_price = 1; // 必需。要在 Play 可能新增的任何地区使用的价格（以美元为单位）。
    Money eur_price = 2; // 必需。要在 Play 可能新增的任何地区使用的价格（以欧元为单位）。
    string availability = 3; // 必需。新地区配置的地区提供情况。当设置为 AVAILABLE 时，定价信息将用于 Play 未来可能新增的任何地区。
}

message OfferTag {
    string tag = 1; // 必须符合 RFC-1034 的要求。也就是说，相应字符串只能包含小写字母 (a-z)、数字 (0-9) 和连字符 (-)，并且长度不得超过 20 个字符。
}


// 可以购买的购买选项。
message OneTimeProductBuyPurchaseOption {
    bool legacy_compatible = 1; // 可选。用于表示在不支持一次性商品的旧版 Play 结算库流程中，是否提供相应购买选项。最多只能将一个“购买”购买选项标记为“向后兼容”
    bool multi_quantity_enabled = 2; // 可选。相应购买选项是否允许多数量。多件购买功能可让买家在单次结账中购买多件商品。
}

// 可以租借的购买选项。
message OneTimeProductRentPurchaseOption {
    string rental_period = 1; // 必需。用户拥有使用权的时长。自购买流程完成时起生效。采用 ISO 8601 格式指定。
    string expiration_period = 2; // 可选。用户在开始使用使用权后，使用权被撤消前的剩余时间。采用 ISO 8601 格式指定。
}

// 一次性商品的单个购买选项。
message OneTimeProductPurchaseOption {
    string purchase_option_id = 1; // 必需。不可变。相应购买选项的唯一标识符。在一次性商品中必须具有唯一性。必须以数字或小写字母开头，并且只能包含小写字母 (a-z)、数字 (0-9) 和连字符 (-)。长度上限为 63 个字符。
//    枚举
//    STATE_UNSPECIFIED	默认值，切勿使用。
//    DRAFT	相应购买选项目前未向用户提供，以前也从未向用户提供过。
//    ACTIVE	相应购买选项目前已面向用户提供。
//    INACTIVE	相应购买选项不再面向用户提供。
//    INACTIVE_PUBLISHED	相应购买选项已不再提供，但为了实现向后兼容性，我们会继续通过 Play 结算库公开其优惠。只有自动完成迁移的购买选项才能处于此状态。
    string state = 2; // 仅限输出。购买选项的状态，即是否有效。此字段无法通过更新资源来更改。请改为使用专用端点。
    repeated RegionalPricingAndAvailabilityConfig regional_pricing_and_availability_configs = 3; // 相应购买选项的地区性定价和提供情况信息。
    OneTimeProductPurchaseOptionNewRegionsConfig new_regions_config = 4; // Google Play 未来可能新增的任何地区所对应的定价信息。如果省略，则不会在 Play 未来可能新增的任何地区自动提供购买选项。
    repeated OfferTag offer_tags = 5; // 可选。为相应购买选项指定、通过结算库返回到应用的自定义标记的列表（最多 20 个自定义标记）。相应购买选项的优惠也将通过结算库收到这些标记。
    PurchaseOptionTaxAndComplianceSettings tax_and_compliance_settings = 6; // 可选。有关税费和法规遵从方面的详细信息。

    // Union field purchase_option_type can be only one of the following:
    OneTimeProductBuyPurchaseOption buy_option = 7; // 可以购买的购买选项。
    OneTimeProductRentPurchaseOption rent_option = 8; // 可以租借的购买选项。
}

// 在相应国家/地区，必须使用在本国家/地区注册的支付方式来购买相应商品。如果为空，则表示未施加任何支付地点限制。
message RestrictedPaymentCountries {
    repeated string region_codes = 1; // 必需。用于施加付款限制的地区代码，由 ISO 3166-2 定义，例如地区代码“US”表示美国。
}

// 一次性商品
message OneTimeProduct {
    map<string, string> data = 1;           // 导入数据, CSV 格式时使用.

    // 商品详细字段
    string package_name = 10;               // 父级应用的软件包名称
    string product_id = 11;                 // 必需。不可变。商品的唯一商品 ID。在父级应用内具有唯一性。商品 ID 必须以数字或小写字母开头，并且可以包含数字 (0-9)、小写字母 (a-z)、下划线 (_) 和句点 (.)。
    repeated OneTimeProductListing listings = 12;   // 必需。一组已本地化的商品名和说明数据。不能存在具有相同 languageCode 的重复条目。
    OneTimeProductTaxAndComplianceSettings tax_and_compliance_settings = 13; // 有关税费和法规遵从方面的详细信息
    repeated OneTimeProductPurchaseOption purchase_options = 14; // 必需。相应一次性商品的购买选项集。
    RestrictedPaymentCountries restricted_payment_countries = 15; // 可选。在相应国家/地区，必须使用在本国家/地区注册的支付方式来购买相应一次性商品。如果为空，则表示未施加任何支付地点限制。
    repeated OfferTag offer_tags = 16; // 可选。为相应一次性商品指定、通过结算库返回到应用的自定义标记的列表（最多 20 个自定义标记）。相应商品的购买选项和优惠也将通过结算库收到这些标记。
    RegionsVersion regions_version = 17; // 仅限输出。用于生成一次性商品的地区配置的版本。
}

message OneTimeProductUpdateRequest {
    OneTimeProduct one_time_product = 1; // 必需。要更新/插入的一次性商品
    string update_mask = 2; // 必需。要更新的字段的列表。
//    这是完全限定字段名称的逗号分隔列表。示例："user.displayName,photo"。

    RegionsVersion regions_version = 3; // 必需。当前用于一次性商品的可用地区的版本。

    bool allow_missing = 4;                 // 如果设置为 true，且不存在具有指定 packageName 和 sku 的应用内商品，则系统将创建该应用内商品。
    /*
    PRODUCT_UPDATE_LATENCY_TOLERANCE_UNSPECIFIED	默认值为 PRODUCT_UPDATE_LATENCY_TOLERANCE_LATENCY_SENSITIVE。
    PRODUCT_UPDATE_LATENCY_TOLERANCE_LATENCY_SENSITIVE	更新平均在几分钟内传播到客户端，在极少数情况下则长达数小时。吞吐量上限为每个应用每小时 7200 次更新。
    PRODUCT_UPDATE_LATENCY_TOLERANCE_LATENCY_TOLERANT	更新将在 24 小时内传播到各客户端。使用批量修改方法支持高吞吐量，每个应用每小时最多执行 72 万次更新。
    */
    string latency_tolerance = 5;           // 可选。相应商品更新的传播延迟容忍度。默认设置为对延迟敏感。
}

message OneTimeProductBatchUpdateRequest {
    repeated OneTimeProductUpdateRequest requests = 1; // 一个或多个单独的更新请求。至少需要有一个请求。最多可包含 100 个请求。所有请求必须分别对应于不同的应用内商品。
}

message OneTimeProductBatchUpdateResponse {
    repeated OneTimeProduct one_time_products = 1;         // 已更新或已插入的应用内商品。
}
